{{ $image := .Get "image" }}
{{ $status := .Get "status" }}
{{ $envParam := .Get "environment" }}

{{ $environment := "" }}
{{ if or (eq $envParam "grid") (eq $envParam "") }}
  {{ $environment = "versions" }}
{{ else if eq $envParam "dedicated-gen-2" }}
  {{ $environment = "versions-dedicated-gen-2" }}
{{ else if eq $envParam "dedicated-gen-3" }}
  {{ $environment = "versions-dedicated-gen-3" }}
{{ else }}
  {{ errorf "Incorrect environment param: %q. Possible values are grid, dedicated-gen-2, and dedicated-gen-3. Empty defaults to \"grid\". Image: %s" $envParam $image }}
{{ end }}

{{- $baseURL := .Site.Params.registryBaseURL -}}
{{- $url := printf "%s/%s?items=versions" $baseURL $image -}}
{{- $remote := resources.GetRemote $url -}}


{{- $data := $remote.Content | transform.Unmarshal | default dict -}}
{{- $versions := $data.versions | default dict -}}

{{ if index $versions $status }}
  {{ if gt (len (index $versions $status)) 0 }}
    <ul>
      {{ range index $versions $status }}
        <li>{{ . }}</li>
      {{ end }}
    </ul>
  {{ else if ne $status "deprecated" }}
    None available
  {{ end }}
{{ else }}
  {{ if and (eq $envParam "dedicated") (eq $status "supported") }}
    None available
  {{ else }}
    None available
  {{ end }}
{{ end }}
