---
title: Configure your infrastructure
description: Configure infrastructure for your Flask app on {{% vendor/name %}}
weight: -200
---

To prepare your Flask project for use on {{% vendor/name %}},
you need to generate {{% vendor/name %}} configuration files,
as well as create and configure a {{% vendor/name %}} project.

To do so, make sure you have the [{{% vendor/name %}} CLI](/administration/cli/_index.md) installed
and [authenticated with your {{% vendor/name %}} account](/administration/cli/_index.md#2-authenticate).

## Generate your {{% vendor/name %}} configuration files

1. To generate the configuration files needed to deploy your app on {{% vendor/name %}},
   run the following command:

   ```bash {location="Terminal"}
   {{% vendor/cli %}} project:init
   ```

   This command is also available as `{{% vendor/cli %}} ify`.

2. Follow the prompts to determine your project requirements:

   - Select Python as the language for your project.</br>
     {{% vendor/name %}} then automatically detects your dependency manager.

   - Enter the name of your app.

   - Select the services you need (for this guide, select `PostgreSQL` as we'll use it later)

   - Hit **Enter**.</br>

   Your {{% vendor/name %}} configuration files are generated.

3. Add all the generated files to your Git repository.
   To do so, run the following commands:

   ```bash {location="Terminal"}
   git add .
   git commit -m "Initial commit"
   ```

## Create your {{% vendor/name %}} project

To deploy your Flask project on {{% vendor/name %}},
you need to create and configure a {{% vendor/name %}} project first.

1. To create your {{% vendor/name %}} project,
   run the following command:

   ```bash {location="Terminal"}
   {{% vendor/cli %}} project:create
   ```

2. To configure your {{% vendor/name %}} project, follow the prompts:

   - Create or select your organization.

   - Name your project.

   - Select the region where you want your project to be hosted.

   - Specify the branch name.</br>
     Use the same branch name as [defined previously](/get-started/flask/deploy/setup.md#initialize-your-repository).

   - Set {{% vendor/name %}} as your repository remote.

   Your {{% vendor/name %}} project is created.

## Configure your {{% vendor/name %}} project

To complete the deployment of your Flask app on {{% vendor/name %}},
you need to add app-specific configurations to your {{% vendor/name %}} project.</br>
To do so, make the following changes to the `{{% vendor/configfile "app" %}}` file automatically generated by the {{% vendor/name %}} CLI:

1. Specify how your app must be loaded.</br>
   To do so, add a `FLASK_APP` variable for all your environments and point it to your `autoapp.py` file.
   Locate the section dedicated to environment variables:

   ```yaml {configFile="app"}
   # Variables to control the environment. More information: https://docs.upsun.com/create-apps/app-reference.html#variables
   # variables:
   #   env:
   #     # Add environment variables here that are static.
   #     PYTHONUNBUFFERED: "1"
   ```

   Uncomment the `variables:`and `env:` lines, and add your environment variable:

   ```yaml {configFile="app"}
   variables:
     env:
       FLASK_APP: autoapp.py
   ```

   {{< note >}}
   When you uncomment a section in a YAML file, remove **both** the comment marker `#` and the extra space.
   Failure to do so results in an `Invalid block mapping key indent` error when the configuration file is validated.
   {{< /note >}}

2. Configure some writable disk space to hold the static assets that `flask-static-digest` generates and `npm` builds.</br>
   To do so, define the `./<APP_NAME>/static` directory as [a mount](/create-apps/app-reference.md#mounts).
   Locate the section dedicated to mounts:

   ```yaml {configFile="app"}
   # Mounts define directories that are writable after the build is complete.
   # More information: https://docs.upsun.com/create-apps/app-reference.html#mounts
   # mounts:
   #   "/.cache": # Represents the path in the app.
   #     source: "storage" # "local" sources are unique to the app, while "service" sources can be shared among apps.
   #     source_path: "cache" # The subdirectory within the mounted disk (the source) where the mount should point.
   ```

   Uncomment the `# mounts:` line, and add an entry describing where you want to add a writable mount:

   ```yaml {configFile="app"}
   mounts:
       "<APP_NAME>/static":
           source: "storage"
           source_path: "static_assets"
   ```
  Replacing `<APP_NAME>` above with the `app_name` you [defined previously](#1-optional-generate-a-flask-project-with-cookiecutter).

3. Instruct {{% vendor/name %}} to automatically run `npm install` when building the application container.</br>
   To do so, customize your [build hook](/create-apps/hooks/hooks-comparison.html#build-hook).
   Locate the section dedicated to it:

   ```yaml {configFile="app"}
   # Hooks allow you to customize your code/environment as the project moves through the build and deploy stages
   # More information: https://docs.upsun.com/create-apps/app-reference.html#hooks
   hooks:
     # The build hook is run after any build flavor.
     # More information: https://docs.upsun.com/create-apps/hooks/hooks-comparison.html#build-hook
     build: |
         set -eux
         pip install -r requirements.txt
    ```

   The  {{% vendor/name %}} CLI automatically added `pip install -r requirements.txt` to your build hook configuration.</br>
   If you want `pip` to be upgraded first, add  `pip install --upgrade pip` to the above line.</br>
   Then, add `npm install`:

   ```yaml {configFile="app"}
   hooks:
       build: |
           set -eux
           pip install --upgrade pip
           pip install -r requirements.txt
           npm install
    ```
4. Instruct {{% vendor/name %}} to automatically run `npm run build` when building the application container.</br>
   To do so, customize your [deploy hook](/create-apps/hooks/hooks-comparison.html#deploy-hook).
   Locate the section dedicated to it:

   ```yaml {configFile="app"}
   # The deploy hook is run after the app container has been started, but before it has started accepting requests.
   # More information: https://docs.upsun.com/create-apps/hooks/hooks-comparison.html#deploy-hook
   deploy: |
        set -eux
        # echo 'Put your deploy command here'
   ```

   Add `npm run build`:

   ```yaml {configFile="app"}
   deploy: |
        set -eux
        npm run build
   ```

5. [Configure the web server](https://docs.platform.sh/create-apps.html#configure-whats-served) running in front of your app
   to define how your app handles dynamic requests.
   To do so, locate the section dedicated to the web server:

   ```yaml {configFile="app"}
   # The web key configures the web server running in front of your app.
   # More information: https://docs.upsun.com/create-apps/app-reference.html#web
   web:
     # Commands are run once after deployment to start the application process.
     # More information: https://docs.upsun.com/create-apps/app-reference.html#web-commands
   ```

   To add a basic Flask server, replace the default information added by the {{% vendor/name %}} CLI with `flask run -p $PORT`.</br>
   Also, change the `socket_family` value from `unix` to `tcp`:

   ```yaml {configFile="app"}
   web:
     commands:
       start: "flask run -p $PORT"
     upstream:
       socket_family: tcp
   ```

6. To commit your changes, run the following commands:
   ```bash {location="Terminal"}
   git add {{% vendor/configfile "app" %}}
   git commit -m "Adds FLASK_APP env var, adds mount for static builds, build commands, npm run build on deploy, web start command"
   ```

   {{< note >}}
   By default, the `{{% vendor/cli %}} project:init` command sets the language runtime to the latest possible version.

   If your project requires an older version, before pushing your code to {{% vendor/name %}},
   open your `{{< vendor/configfile "app" >}}` file and change the value of the `type` key (near the top of the file) to the desired version.
   See the [complete list of supported Python versions](/languages/python/_index.md#supported-versions).

   Make sure you add and commit your changes to Git before pushing your code.
   {{< /note >}}

{{< guide-buttons next="Environment variables" >}}
